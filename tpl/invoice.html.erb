<% def date_format(date); return unless date; date.strftime "%d.%m.%Y"; end %>
<% def simple_format(text); text.to_s.gsub(/\n/, '<br />'); end %>
<% def array_format(array); array.join('<br />'); end %>
<% def money_format(value); return '-' unless value; sprintf("%02.2f", value).gsub('.', ','); end %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pl" lang="pl">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style type="text/css">
      body {
        font-family: verdana, helvetica, arial, sans-serif;
        font-size: 13px;
        margin: 1em 2em 1em 2em;
        line-height: 1.3em;
      }
      h1 { font-size: 1.2em; }
      h2 { font-size: 1.1em; }
      .tal { text-align: left }
      .tam { text-align: center }
      .tar { text-align: right }
      .no-border { border: 0 }
      .fl { float: left }
      .fr { float: right }
      label { display: block; width: 150px; float: left }
      .space { clear: both; height: 30px }
      .clear { clear: both }
      table {
        clear: both;
        width: 100%;
        font-size: inherit;
        border: 0;
        border-collapse: collapse;
      }
      th, td { text-align: center; padding: 0.5em 1em; }
      th { font-weight: bold; border-bottom: 1px solid black; vertical-align: bottom }
      td { border-bottom: 1px solid black; vertical-align: top; }

    </style>
  </head>
  <body>
    <div class="fl">
      <h1><% data[:proforma] ? 'Proforma' : 'Faktura' %> nr <%= data[:number] %></h1>
      <label>Data wystawienia:</label> <%= date_format data[:create_date] %><br />
      <% unless data[:proforma] %>
        <label>Data sprzedaży:</label> <%= date_format data[:trade_date] %><br />
      <% end %>
      <label>Sposób zapłaty:</label> <%= data[:payment_type] %><br />
      <label>Termin płatności:</label>
      <% if data[:paid] %>
        <b>zapłacono</b>
      <% else %>
        <%= date_format data[:payment_date] %>
      <% end %>
    </div>

    <div class="space">&nbsp;</div>

    <div class="fl" style="width: 50%"><h2>Sprzedawca:</h2><%= array_format data[:seller] %></div>
    <div class="fr" style="width: 50%"><h2>Nabywca:</h2><%= array_format data[:buyer] %></div>

    <div class="space">&nbsp;</div>

    <table>
      <tr>
        <th width="30%" class="tal">Nazwa towaru/usługi</th>
        <th width="1%" class="tam">PKWiU</th>
        <th width="1%">Il.</th>
        <th width="1%">J.m.</th>
        <th width="5%" class="tar">Cena netto</th>
        <th width="5%" class="tar">Wart. netto</th>
        <% unless data[:proforma] %>
          <th width="1%" class="tar">VAT</th>
          <th width="1%" class="tar">Kwota VAT</th>
        <% end %>
        <th width="5%" class="tar">Wart. brutto</th>
      </tr>
      <tr>
        <td class="tal"><%= data[:item_name] %></td>
        <td class="tam"><%= data[:pkwiu] %></td>
        <td class="tam">1</td>
        <td class="tam">usł.</td>
        <td class="tar"><%= money_format data[:net_value] %></td>
        <td class="tar"><%= money_format data[:net_value] %></td>
        <% unless data[:proforma] %>
          <td class="tar"><%= data[:vat] %></td>
          <td class="tar"><%= money_format data[:vat_value] %></td>
        <% end %>
        <td class="tar"><%= money_format data[:price] %></td>
      </tr>
      <tr>
        <td class="no-border" colspan="4">&nbsp;</td>
        <td class="no-border tar">Razem</td>
        <td class="tar"><%= money_format data[:net_value] %></td>
        <% unless data[:proforma] %>
          <td class="tar"><%= data[:vat] %></td>
          <td class="tar"><%= money_format data[:vat_value] %></td>
        <% end %>
        <td class="tar"><%= money_format data[:price] %></td>
      </tr>
    </table>

    <div class="space">&nbsp;</div>

    <label>Do zapłaty:</label> <%= money_format data[:price] %>&nbsp;zł<br />
    <label>Słownie:</label> <%= data[:price_in_words] %><br />
    <% if data[:comment] %>
      <p><label>Uwagi:</label> <%= data[:comment] %></p>
    <% end %>

    <div class="space">&nbsp;</div>

    <% if data[:proforma] %>
      <p><b>Proforma nie jest dowodem księgowym i nie należy jej księgować.</b></p>
      <div class="space">&nbsp;</div>
    <% end %>

    <p class="fl tam">Osoba upoważniona do wystawienia faktury VAT<br /><b><%= data[:created_by] %></b></p>
    <p class="fr">Faktura bez podpisu odbiorcy</p>
  <body>
</html>
